# 🎮 Match-3 遊戲機制詳解

## 📋 遊戲基本流程

### 1. 交換階段 (Swap Phase)
- 玩家選擇兩個**相鄰的方塊**進行交換
- 只允許水平或垂直相鄰的方塊交換
- 交換必須能形成至少一個三消才有效

### 2. 匹配檢測 (Match Detection)
- 檢測水平和垂直方向上**3個或以上**相同顏色的連續方塊
- 匹配的方塊會被標記為待消除狀態

### 3. 方塊消除 (Tile Clearing)
- 被匹配的方塊從棋盤上移除
- 播放消除動畫和粒子效果
- 計算得分

### 4. 重力系統 (Gravity System) 🔥 **核心機制**
這是三消遊戲最重要的物理規則：

#### 4.1 重力原則
- **所有方塊受重力影響向下掉落**
- **方塊保持原有的相對順序**
- **空格只會出現在棋盤頂部**

#### 4.2 重力過程
```
消除前：         消除後：         重力後：
A B C           A B C           _ _ _
D E F    ->     D _ F    ->     A B C
G H I           G H I           D G F
                                G H I
```

#### 4.3 重力實現邏輯
1. **收集有效方塊**：從上到下收集每列的非空方塊
2. **清空列**：將整列標記為空
3. **重新放置**：從底部開始，按原有順序放置方塊
4. **留空頂部**：頂部留出空格等待新方塊

### 5. 方塊補充 (Tile Refill)
- 在棋盤頂部的空格位置生成新方塊
- 新方塊會智能生成，避免立即形成三消
- 新方塊從上方掉落動畫

### 6. 連鎖檢測 (Cascade Detection)
- 重力和補充完成後，檢查是否有新的三消
- 如果有，重複步驟 3-6，形成連鎖
- 連鎖會持續直到沒有新的匹配

### 7. 連鎖計分 (Cascade Scoring)
- **基礎分數**：每個方塊 10 分
- **連鎖加成**：第 N 級連鎖有 1.5^(N-1) 倍加成
- 例如：第一級 1x，第二級 1.5x，第三級 2.25x

## 🎯 遊戲策略技巧

### 優先級策略
1. **底部優先**：在棋盤底部製造消除，容易形成連鎖
2. **多方向匹配**：同時匹配水平和垂直方向
3. **預判連鎖**：觀察消除後可能的連鎖效果

### 高分技巧
- 尋找能形成多級連鎖的移動
- 優先清除底部，讓上方方塊自然掉落
- 觀察顏色分布，規劃多步移動

## 🔧 技術實現要點

### 重力系統核心代碼
```typescript
// 正確的重力實現
for (let i = 0; i < validTiles.length; i++) {
  const targetRow = emptySpaces + i;  // 從底部開始放置
  const { tile, originalRow } = validTiles[i]!; // 保持原有順序
  this.board[targetRow]![col] = tile;
}
```

### 關鍵原則
1. **物理一致性**：重力必須符合真實世界物理
2. **順序保持**：方塊相對位置不能顛倒
3. **空格管理**：空格只能在頂部
4. **動畫流暢**：移動軌跡必須合理

## 🚨 常見錯誤

### ❌ 錯誤的重力實現
- 方塊順序顛倒
- 空格出現在中間
- 方塊懸浮在空中

### ✅ 正確的重力實現
- 方塊按原順序向下緊密排列
- 空格只在頂部
- 符合物理直覺

## 📈 遊戲平衡

### 難度設計
- **方塊種類**：5種顏色提供適當複雜度
- **棋盤大小**：8x8 適合大多數設備
- **連鎖機制**：獎勵策略性思考

### 用戶體驗
- **即時反饋**：消除和得分立即顯示
- **視覺清晰**：動畫幫助理解遊戲狀態
- **操作簡單**：點擊交換，直觀易懂